name: Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Download ACT
      run: |
        $downloadUrl = "https://advancedcombattracker.com/download.php?id=57"
        Invoke-WebRequest -Uri $downloadUrl -OutFile "ACT-Installer.exe"

    - name: Install ACT
      run: |
        mkdir C:\ACT
        .\ACT-Installer.exe /S /D=C:\ACT

    - name: Build solution
      run: |
        nuget restore NEO_ACT_Plugin.sln
        msbuild NEO_ACT_Plugin.sln /p:Configuration=Release /p:Platform="Any CPU" /p:ReferencePath="C:\ACT"

    - name: Run tests
      run: |
        vstest.console.exe "NEO_ACT_Plugin.Test\bin\Release\NEO_ACT_Plugin.Test.dll"